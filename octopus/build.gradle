plugins {
    id 'application'
    id "org.jetbrains.kotlin.jvm"
}

application {
    mainClassName = 'com.koupper.octopus.OctopusKt'
}

version = '4.0.0'

jar {
    duplicatesStrategy = DuplicatesStrategy.INCLUDE

    manifest {
        attributes 'Main-Class': 'com.koupper.octopus.OctopusKt'
    }
    from {
        configurations.runtimeClasspath.collect {
            it.isDirectory() ? it : zipTree(it)
        }
    }
}

task optimized(type: Jar) {
    manifest {
        attributes 'Main-Class': 'com.koupper.octopus.OctopusKt'
    }
    from sourceSets.main.output
    from {
        configurations.runtimeClasspath.filter {
            it.name.contains("container") || it.name.contains("providers") || it.name.contains("configurations") || it.name.contains("shared") || it.name.contains("os")
        }.collect {
            println("Octopus dependency Included: ${it.name}")
            it.isDirectory() ? it : zipTree(it)
        }
    }
    doLast {
        println("Octopus generated.")
    }
}
